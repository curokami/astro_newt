---
import Layout from "../../layouts/Layout.astro";
import { getArticles } from "../../lib/newt";
import Search from "../../components/Search.tsx";

// âœ… `_id`, `title`, `body` ã®ã¿ã‚’ JSON ã«å«ã‚ã‚‹
const articles = await getArticles();
const articlesJson = JSON.stringify(
  articles.map(({ _id, title, body }) => ({
    _id: _id?.toString() || "",  // ğŸ”¹ _id ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã—ã€null ã®å ´åˆã¯ç©ºæ–‡å­—ã«ã™ã‚‹
    title,
    body
  }))
).replace(/</g, "\\u003c") // âœ… HTML ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
 .replace(/>/g, "\\u003e")
 .replace(/&/g, "\\u0026");

console.log("ğŸ” index.astro ã§åŸ‹ã‚è¾¼ã‚€ JSON:", articlesJson);
---

<Layout title="ãƒ–ãƒ­ã‚°ä¸€è¦§" description="æœ€æ–°ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ä¸€è¦§">
  <h1 class="title">ãƒ–ãƒ­ã‚°æ¤œç´¢</h1>

  <!-- âœ… JSON ã‚’ script ã‚¿ã‚°ã¨ã—ã¦é©åˆ‡ã«åŸ‹ã‚è¾¼ã‚€ -->
  <script id="articles-data" type="application/json">
    {JSON.stringify(articles.map(({ _id, title, body }) => ({
      _id: _id?.toString() || "",  // âœ… `_id` ã‚’æ˜ç¤ºçš„ã«æ–‡å­—åˆ—ã«å¤‰æ›
      title,
      body
    })))}
  </script>

  <Search client:load />
</Layout>

<style>
  .search-box {
    display: block;
  }
</style>