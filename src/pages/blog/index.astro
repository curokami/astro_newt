---
import Layout from "../../layouts/Layout.astro";
import { getArticles } from "../../lib/newt";
import Search from "../../components/Search.tsx";

// âœ… `_id`, `slug`, `title`, `body` ã®ã¿ã‚’ JSON ã«å«ã‚ã‚‹
const articles = await getArticles();
const articlesJson = JSON.stringify(
  articles.map(({ _id, slug, title, body }) => ({ _id, slug, title, body })) // âœ… `_id` ã¨ `slug` ã‚’è¿½åŠ 
).replace(/</g, "\\u003c") // âœ… HTML ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
 .replace(/>/g, "\\u003e")
 .replace(/&/g, "\\u0026")
 .replace(/\n/g, "\\n"); // âœ… æ”¹è¡Œã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—

console.log("ğŸ” index.astro ã§åŸ‹ã‚è¾¼ã‚€ JSON:", articlesJson);
console.log("ğŸ“Œ è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã®å‹ãƒã‚§ãƒƒã‚¯:", articles.map(a => ({ _id: typeof a._id, title: a.title })));
---

<Layout title="ãƒ–ãƒ­ã‚°ä¸€è¦§" description="æœ€æ–°ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ä¸€è¦§">
  <h1 class="title">ãƒ–ãƒ­ã‚°æ¤œç´¢</h1>

  <!-- âœ… JSON ã‚’ script ã‚¿ã‚°ã¨ã—ã¦é©åˆ‡ã«åŸ‹ã‚è¾¼ã‚€ -->
  <script id="articles-data" type="application/json" set:html={articlesJson}></script>

  <Search client:load />
</Layout>

<style>
  .search-box {
    display: block;
  }
</style>